'use strict';

var _powerAssertRecorder = function () { function PowerAssertRecorder() { this.captured = []; } PowerAssertRecorder.prototype._capt = function _capt(value, espath) { this.captured.push({ value: value, espath: espath }); return value; }; PowerAssertRecorder.prototype._expr = function _expr(value, source) { var capturedValues = this.captured; this.captured = []; return { powerAssertContext: { value: value, events: capturedValues }, source: source }; }; return PowerAssertRecorder; }();

var _ava = require('ava');

var _ava2 = _interopRequireDefault(_ava);

var _core = require('../lib/core');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

(0, _ava2.default)('should detect background images in CSS rules', function (t) {
	var _rec = new _powerAssertRecorder(),
	    _rec2 = new _powerAssertRecorder(),
	    _rec3 = new _powerAssertRecorder(),
	    _rec4 = new _powerAssertRecorder();

	var background = '.selector-b { background: url(square.png) no-repeat 0 0; }';
	var backgroundImage = '.selector-a { background-image: url(circle.png); }';
	var backgroundBlock = '\n\t\t.selector-b {\n\t\t\tcolor: #fff;\n\t\t\tbackground: url(square.png) no-repeat 0 0\n\t\t}\n\t';
	var backgroundColor = '.selector-a { background: #fff; }';

	t.truthy(_rec._expr(_rec._capt((0, _core.hasImageInRule)(_rec._capt(background, 'arguments/0/arguments/0')), 'arguments/0'), {
		content: 't.truthy(hasImageInRule(background))',
		filepath: 'test/02-utilities.js',
		line: 24
	}));
	t.truthy(_rec2._expr(_rec2._capt((0, _core.hasImageInRule)(_rec2._capt(backgroundImage, 'arguments/0/arguments/0')), 'arguments/0'), {
		content: 't.truthy(hasImageInRule(backgroundImage))',
		filepath: 'test/02-utilities.js',
		line: 25
	}));
	t.truthy(_rec3._expr(_rec3._capt((0, _core.hasImageInRule)(_rec3._capt(backgroundBlock, 'arguments/0/arguments/0')), 'arguments/0'), {
		content: 't.truthy(hasImageInRule(backgroundBlock))',
		filepath: 'test/02-utilities.js',
		line: 26
	}));
	t.falsy(_rec4._expr(_rec4._capt((0, _core.hasImageInRule)(_rec4._capt(backgroundColor, 'arguments/0/arguments/0')), 'arguments/0'), {
		content: 't.falsy(hasImageInRule(backgroundColor))',
		filepath: 'test/02-utilities.js',
		line: 27
	}));
});

(0, _ava2.default)('should return the url of an image', function (t) {
	var _rec5 = new _powerAssertRecorder(),
	    _rec6 = new _powerAssertRecorder(),
	    _rec7 = new _powerAssertRecorder(),
	    _rec8 = new _powerAssertRecorder();

	var background = '.selector-b { background: url(square.png) no-repeat 0 0; }';
	var backgroundImage = '.selector-a { background-image: url(circle.png); }';
	var backgroundBlock = '\n\t\t.selector-b {\n\t\t\tcolor: #fff;\n\t\t\tbackground: url(square.png) no-repeat 0 0\n\t\t}\n\t';
	var backgroundColor = '.selector-a { background: #fff; }';

	t.deepEqual(_rec5._expr(_rec5._capt(_rec5._capt((0, _core.getImageUrl)(_rec5._capt(background, 'arguments/0/object/arguments/0')), 'arguments/0/object')[1], 'arguments/0'), {
		content: 't.deepEqual(getImageUrl(background)[1], \'square.png\')',
		filepath: 'test/02-utilities.js',
		line: 41
	}), 'square.png');
	t.deepEqual(_rec6._expr(_rec6._capt(_rec6._capt((0, _core.getImageUrl)(_rec6._capt(backgroundImage, 'arguments/0/object/arguments/0')), 'arguments/0/object')[1], 'arguments/0'), {
		content: 't.deepEqual(getImageUrl(backgroundImage)[1], \'circle.png\')',
		filepath: 'test/02-utilities.js',
		line: 42
	}), 'circle.png');
	t.deepEqual(_rec7._expr(_rec7._capt(_rec7._capt((0, _core.getImageUrl)(_rec7._capt(backgroundBlock, 'arguments/0/object/arguments/0')), 'arguments/0/object')[1], 'arguments/0'), {
		content: 't.deepEqual(getImageUrl(backgroundBlock)[1], \'square.png\')',
		filepath: 'test/02-utilities.js',
		line: 43
	}), 'square.png');
	t.deepEqual(_rec8._expr(_rec8._capt(_rec8._capt((0, _core.getImageUrl)(_rec8._capt(backgroundColor, 'arguments/0/object/arguments/0')), 'arguments/0/object')[1], 'arguments/0'), {
		content: 't.deepEqual(getImageUrl(backgroundColor)[1], \'\')',
		filepath: 'test/02-utilities.js',
		line: 44
	}), '');
});

(0, _ava2.default)('shoud return the url of an image in compressed CSS rules', function (t) {
	var _rec9 = new _powerAssertRecorder(),
	    _rec10 = new _powerAssertRecorder(),
	    _rec11 = new _powerAssertRecorder();

	var background = '.selector-a{background:url(square.png) no-repeat 0 0;transform:scale(0.5)}';
	var backgroundImage = '.selector-a{background-image:url(square.png);transform:scale(0.5)}';
	var backgroundColor = '.selector-a{background:#fff;transform:scale(0.5)}';

	t.deepEqual(_rec9._expr(_rec9._capt(_rec9._capt((0, _core.getImageUrl)(_rec9._capt(background, 'arguments/0/object/arguments/0')), 'arguments/0/object')[1], 'arguments/0'), {
		content: 't.deepEqual(getImageUrl(background)[1], \'square.png\')',
		filepath: 'test/02-utilities.js',
		line: 52
	}), 'square.png');
	t.deepEqual(_rec10._expr(_rec10._capt(_rec10._capt((0, _core.getImageUrl)(_rec10._capt(backgroundImage, 'arguments/0/object/arguments/0')), 'arguments/0/object')[1], 'arguments/0'), {
		content: 't.deepEqual(getImageUrl(backgroundImage)[1], \'square.png\')',
		filepath: 'test/02-utilities.js',
		line: 53
	}), 'square.png');
	t.deepEqual(_rec11._expr(_rec11._capt(_rec11._capt((0, _core.getImageUrl)(_rec11._capt(backgroundColor, 'arguments/0/object/arguments/0')), 'arguments/0/object')[1], 'arguments/0'), {
		content: 't.deepEqual(getImageUrl(backgroundColor)[1], \'\')',
		filepath: 'test/02-utilities.js',
		line: 54
	}), '');
});

(0, _ava2.default)('should remove get params', function (t) {
	var _rec12 = new _powerAssertRecorder();

	var background = '.selector-b { background: url(square.png?v1234) no-repeat 0 0; }';
	t.deepEqual(_rec12._expr(_rec12._capt(_rec12._capt((0, _core.getImageUrl)(_rec12._capt(background, 'arguments/0/object/arguments/0')), 'arguments/0/object')[1], 'arguments/0'), {
		content: 't.deepEqual(getImageUrl(background)[1], \'square.png\')',
		filepath: 'test/02-utilities.js',
		line: 59
	}), 'square.png');
});

(0, _ava2.default)('should remove the quotes', function (t) {
	var _rec13 = new _powerAssertRecorder();

	var background = '.selector-b { background: url("square.png") no-repeat 0 0; }';
	t.deepEqual(_rec13._expr(_rec13._capt(_rec13._capt((0, _core.getImageUrl)(_rec13._capt(background, 'arguments/0/object/arguments/0')), 'arguments/0/object')[1], 'arguments/0'), {
		content: 't.deepEqual(getImageUrl(background)[1], \'square.png\')',
		filepath: 'test/02-utilities.js',
		line: 65
	}), 'square.png');
});

(0, _ava2.default)('should allow only local files', function (t) {
	var _rec14 = new _powerAssertRecorder(),
	    _rec15 = new _powerAssertRecorder(),
	    _rec16 = new _powerAssertRecorder();

	var local = 'sprite/test.png';
	var http = 'http://example.com/test.png';
	var base64 = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIA';

	t.truthy(_rec14._expr(_rec14._capt((0, _core.isImageSupported)(_rec14._capt(local, 'arguments/0/arguments/0')), 'arguments/0'), {
		content: 't.truthy(isImageSupported(local))',
		filepath: 'test/02-utilities.js',
		line: 73
	}));
	t.falsy(_rec15._expr(_rec15._capt((0, _core.isImageSupported)(_rec15._capt(http, 'arguments/0/arguments/0')), 'arguments/0'), {
		content: 't.falsy(isImageSupported(http))',
		filepath: 'test/02-utilities.js',
		line: 74
	}));
	t.falsy(_rec16._expr(_rec16._capt((0, _core.isImageSupported)(_rec16._capt(base64, 'arguments/0/arguments/0')), 'arguments/0'), {
		content: 't.falsy(isImageSupported(base64))',
		filepath: 'test/02-utilities.js',
		line: 75
	}));
});

(0, _ava2.default)('should detect retina images', function (t) {
	var _rec17 = new _powerAssertRecorder(),
	    _rec18 = new _powerAssertRecorder();

	var retina = 'sprite/test@2x.png';
	var nonRetina = 'sprite/test.png';

	t.truthy(_rec17._expr(_rec17._capt((0, _core.isRetinaImage)(_rec17._capt(retina, 'arguments/0/arguments/0')), 'arguments/0'), {
		content: 't.truthy(isRetinaImage(retina))',
		filepath: 'test/02-utilities.js',
		line: 82
	}));
	t.falsy(_rec18._expr(_rec18._capt((0, _core.isRetinaImage)(_rec18._capt(nonRetina, 'arguments/0/arguments/0')), 'arguments/0'), {
		content: 't.falsy(isRetinaImage(nonRetina))',
		filepath: 'test/02-utilities.js',
		line: 83
	}));
});

(0, _ava2.default)('should extract the ratio of an image', function (t) {
	var _rec19 = new _powerAssertRecorder(),
	    _rec20 = new _powerAssertRecorder(),
	    _rec21 = new _powerAssertRecorder();

	var nonRetina = 'sprite/test.png';
	var retina2x = 'sprite/test@2x.png';
	var retina3x = 'sprite/test@3x.png';

	t.deepEqual(_rec19._expr(_rec19._capt((0, _core.getRetinaRatio)(_rec19._capt(nonRetina, 'arguments/0/arguments/0')), 'arguments/0'), {
		content: 't.deepEqual(getRetinaRatio(nonRetina), 1)',
		filepath: 'test/02-utilities.js',
		line: 91
	}), 1);
	t.deepEqual(_rec20._expr(_rec20._capt((0, _core.getRetinaRatio)(_rec20._capt(retina2x, 'arguments/0/arguments/0')), 'arguments/0'), {
		content: 't.deepEqual(getRetinaRatio(retina2x), 2)',
		filepath: 'test/02-utilities.js',
		line: 92
	}), 2);
	t.deepEqual(_rec21._expr(_rec21._capt((0, _core.getRetinaRatio)(_rec21._capt(retina3x, 'arguments/0/arguments/0')), 'arguments/0'), {
		content: 't.deepEqual(getRetinaRatio(retina3x), 3)',
		filepath: 'test/02-utilities.js',
		line: 93
	}), 3);
});

(0, _ava2.default)('should extract color from declaration value', function (t) {
	var _rec22 = new _powerAssertRecorder(),
	    _rec23 = new _powerAssertRecorder(),
	    _rec24 = new _powerAssertRecorder(),
	    _rec25 = new _powerAssertRecorder(),
	    _rec26 = new _powerAssertRecorder();

	var hexLong = '#000000 url(image.png)';
	var hexShort = '#000 url(image.png)';
	var rgb = 'rgb(255, 255, 255) url(image.png)';
	var rgba = 'rgb(255, 255, 255, .5) url(image.png)';
	var empty = 'url(image.png)';

	t.deepEqual(_rec22._expr(_rec22._capt((0, _core.getColor)(_rec22._capt(hexLong, 'arguments/0/arguments/0')), 'arguments/0'), {
		content: 't.deepEqual(getColor(hexLong), \'#000000\')',
		filepath: 'test/02-utilities.js',
		line: 103
	}), '#000000');
	t.deepEqual(_rec23._expr(_rec23._capt((0, _core.getColor)(_rec23._capt(hexShort, 'arguments/0/arguments/0')), 'arguments/0'), {
		content: 't.deepEqual(getColor(hexShort), \'#000\')',
		filepath: 'test/02-utilities.js',
		line: 104
	}), '#000');
	t.deepEqual(_rec24._expr(_rec24._capt((0, _core.getColor)(_rec24._capt(rgb, 'arguments/0/arguments/0')), 'arguments/0'), {
		content: 't.deepEqual(getColor(rgb), \'rgb(255, 255, 255)\')',
		filepath: 'test/02-utilities.js',
		line: 105
	}), 'rgb(255, 255, 255)');
	t.deepEqual(_rec25._expr(_rec25._capt((0, _core.getColor)(_rec25._capt(rgba, 'arguments/0/arguments/0')), 'arguments/0'), {
		content: 't.deepEqual(getColor(rgba), \'rgb(255, 255, 255, .5)\')',
		filepath: 'test/02-utilities.js',
		line: 106
	}), 'rgb(255, 255, 255, .5)');
	t.deepEqual(_rec26._expr(_rec26._capt((0, _core.getColor)(_rec26._capt(empty, 'arguments/0/arguments/0')), 'arguments/0'), {
		content: 't.deepEqual(getColor(empty), null)',
		filepath: 'test/02-utilities.js',
		line: 107
	}), null);
});

(0, _ava2.default)('should generate spritesheet filename', function (t) {
	var _rec27 = new _powerAssertRecorder(),
	    _rec28 = new _powerAssertRecorder();

	t.deepEqual(_rec27._expr(_rec27._capt((0, _core.makeSpritesheetPath)(_rec27._capt({ spritePath: './' }, 'arguments/0/arguments/0'), _rec27._capt({ groups: _rec27._capt([], 'arguments/0/arguments/1/properties/0/value'), extension: 'png' }, 'arguments/0/arguments/1')), 'arguments/0'), {
		content: 't.deepEqual(makeSpritesheetPath({ spritePath: \'./\' }, { groups: [], extension: \'png\' }), \'sprite.png\')',
		filepath: 'test/02-utilities.js',
		line: 111
	}), 'sprite.png');
	t.deepEqual(_rec28._expr(_rec28._capt((0, _core.makeSpritesheetPath)(_rec28._capt({ spritePath: './' }, 'arguments/0/arguments/0'), _rec28._capt({ groups: _rec28._capt(['@2x'], 'arguments/0/arguments/1/properties/0/value'), extension: 'png' }, 'arguments/0/arguments/1')), 'arguments/0'), {
		content: 't.deepEqual(makeSpritesheetPath({ spritePath: \'./\' }, { groups: [\'@2x\'], extension: \'png\' }), \'sprite.@2x.png\')',
		filepath: 'test/02-utilities.js',
		line: 112
	}), 'sprite.@2x.png');
});

(0, _ava2.default)('should detect comment tokens', function (t) {
	var _rec29 = new _powerAssertRecorder(),
	    _rec30 = new _powerAssertRecorder();

	t.truthy(_rec29._expr(_rec29._capt((0, _core.isToken)('/* @replace|circle.png */'), 'arguments/0'), {
		content: 't.truthy(isToken(\'/* @replace|circle.png */\'))',
		filepath: 'test/02-utilities.js',
		line: 116
	}));
	t.falsy(_rec30._expr(_rec30._capt((0, _core.isToken)('/* circle.png */'), 'arguments/0'), {
		content: 't.falsy(isToken(\'/* circle.png */\'))',
		filepath: 'test/02-utilities.js',
		line: 117
	}));
});
//# sourceMappingURL=../node_modules/.cache/ava/e46bc10e538ece62da3a8b984bd3dc99.js.map
'use strict';

var _index = require('/Users/zhangqian/Documents/flavia/postcss-assert/node_modules/babel-runtime/regenerator/index.js');

var _index2 = _interopRequireDefault(_index);

var _slicedToArray2 = require('/Users/zhangqian/Documents/flavia/postcss-assert/node_modules/babel-runtime/helpers/slicedToArray.js');

var _slicedToArray3 = _interopRequireDefault(_slicedToArray2);

var _asyncToGenerator2 = require('/Users/zhangqian/Documents/flavia/postcss-assert/node_modules/babel-runtime/helpers/asyncToGenerator.js');

var _asyncToGenerator3 = _interopRequireDefault(_asyncToGenerator2);

var _powerAssertRecorder = function () { function PowerAssertRecorder() { this.captured = []; } PowerAssertRecorder.prototype._capt = function _capt(value, espath) { this.captured.push({ value: value, espath: espath }); return value; }; PowerAssertRecorder.prototype._expr = function _expr(value, source) { var capturedValues = this.captured; this.captured = []; return { powerAssertContext: { value: value, events: capturedValues }, source: source }; }; return PowerAssertRecorder; }();

var _ava = require('ava');

var _ava2 = _interopRequireDefault(_ava);

var _postcss = require('postcss');

var _postcss2 = _interopRequireDefault(_postcss);

var _bluebird = require('bluebird');

var _bluebird2 = _interopRequireDefault(_bluebird);

var _lodash = require('lodash');

var _lodash2 = _interopRequireDefault(_lodash);

var _core = require('../lib/core');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

_ava2.default.beforeEach(function (t) {
	var input = '\n\t\t.selector-a { background-image: url(circle@2x.png); }\n\t\t.selector-b { background: url(square@2x.png) no-repeat 0 0; }\n\t';

	t.context.opts = _lodash2.default.merge({
		logger: function logger() {}
	}, _core.defaults);
	t.context.ast = _postcss2.default.parse(input, { from: '/tmp/test.css' });
});

(0, _ava2.default)('should use built-in retina grouping function', function () {
	var _ref = (0, _asyncToGenerator3.default)( /*#__PURE__*/_index2.default.mark(function _callee(t) {
		var _rec = new _powerAssertRecorder(),
		    _rec2 = new _powerAssertRecorder(),
		    _rec3 = new _powerAssertRecorder();

		var images, opts, _ref2, _ref3, _ref4, _ref5;

		return _index2.default.wrap(function _callee$(_context) {
			while (1) {
				switch (_context.prev = _context.next) {
					case 0:
						images = void 0, opts = void 0;


						t.context.opts.retina = true;

						(0, _core.prepareGroupBy)(t.context.opts);
						_context.next = 5;
						return (0, _core.extractImages)(t.context.ast, t.context.opts);

					case 5:
						_ref2 = _context.sent;
						_ref3 = (0, _slicedToArray3.default)(_ref2, 2);
						opts = _ref3[0];
						images = _ref3[1];
						_context.next = 11;
						return (0, _core.applyGroupBy)(t.context.opts, images);

					case 11:
						_ref4 = _context.sent;
						_ref5 = (0, _slicedToArray3.default)(_ref4, 2);
						opts = _ref5[0];
						images = _ref5[1];


						t.truthy(_rec._expr(_rec._capt(_rec._capt(_rec._capt(images, 'arguments/0/left/object').length, 'arguments/0/left') === 2, 'arguments/0'), {
							content: 't.truthy(images.length === 2)',
							filepath: 'test/05-apply-group-by.js',
							line: 26,
							async: true
						}));
						t.truthy(_rec2._expr(_rec2._capt(_rec2._capt(_rec2._capt(_rec2._capt(_rec2._capt(images, 'arguments/0/left/callee/object/object/object')[0], 'arguments/0/left/callee/object/object').groups, 'arguments/0/left/callee/object').indexOf('@2x'), 'arguments/0/left') > _rec2._capt(-1, 'arguments/0/right'), 'arguments/0'), {
							content: 't.truthy(images[0].groups.indexOf(\'@2x\') > -1)',
							filepath: 'test/05-apply-group-by.js',
							line: 27,
							async: true
						}));
						t.truthy(_rec3._expr(_rec3._capt(_rec3._capt(_rec3._capt(_rec3._capt(_rec3._capt(images, 'arguments/0/left/callee/object/object/object')[1], 'arguments/0/left/callee/object/object').groups, 'arguments/0/left/callee/object').indexOf('@2x'), 'arguments/0/left') > _rec3._capt(-1, 'arguments/0/right'), 'arguments/0'), {
							content: 't.truthy(images[1].groups.indexOf(\'@2x\') > -1)',
							filepath: 'test/05-apply-group-by.js',
							line: 28,
							async: true
						}));

					case 18:
					case 'end':
						return _context.stop();
				}
			}
		}, _callee, undefined);
	}));

	return function (_x) {
		return _ref.apply(this, arguments);
	};
}());

(0, _ava2.default)('should use grouping functions provided by user', function () {
	var _ref6 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_index2.default.mark(function _callee2(t) {
		var _rec4 = new _powerAssertRecorder(),
		    _rec5 = new _powerAssertRecorder();

		var images, opts, _ref7, _ref8, _ref9, _ref10;

		return _index2.default.wrap(function _callee2$(_context2) {
			while (1) {
				switch (_context2.prev = _context2.next) {
					case 0:
						images = void 0, opts = void 0;


						t.context.opts.retina = true;
						t.context.opts.groupBy.push(function (image) {
							if (image.url.indexOf('png') === -1) {
								return _bluebird2.default.reject();
							}

							return _bluebird2.default.resolve('png');
						});

						(0, _core.prepareGroupBy)(t.context.opts);

						_context2.next = 6;
						return (0, _core.extractImages)(t.context.ast, t.context.opts);

					case 6:
						_ref7 = _context2.sent;
						_ref8 = (0, _slicedToArray3.default)(_ref7, 2);
						opts = _ref8[0];
						images = _ref8[1];
						_context2.next = 12;
						return (0, _core.applyGroupBy)(t.context.opts, images);

					case 12:
						_ref9 = _context2.sent;
						_ref10 = (0, _slicedToArray3.default)(_ref9, 2);
						opts = _ref10[0];
						images = _ref10[1];


						t.truthy(_rec4._expr(_rec4._capt(_rec4._capt(_rec4._capt(_rec4._capt(_rec4._capt(images, 'arguments/0/left/callee/object/object/object')[0], 'arguments/0/left/callee/object/object').groups, 'arguments/0/left/callee/object').indexOf('png'), 'arguments/0/left') > _rec4._capt(-1, 'arguments/0/right'), 'arguments/0'), {
							content: 't.truthy(images[0].groups.indexOf(\'png\') > -1)',
							filepath: 'test/05-apply-group-by.js',
							line: 48,
							async: true
						}));
						t.truthy(_rec5._expr(_rec5._capt(_rec5._capt(_rec5._capt(_rec5._capt(_rec5._capt(images, 'arguments/0/left/callee/object/object/object')[0], 'arguments/0/left/callee/object/object').groups, 'arguments/0/left/callee/object').indexOf('@2x'), 'arguments/0/left') > _rec5._capt(-1, 'arguments/0/right'), 'arguments/0'), {
							content: 't.truthy(images[0].groups.indexOf(\'@2x\') > -1)',
							filepath: 'test/05-apply-group-by.js',
							line: 49,
							async: true
						}));

					case 18:
					case 'end':
						return _context2.stop();
				}
			}
		}, _callee2, undefined);
	}));

	return function (_x2) {
		return _ref6.apply(this, arguments);
	};
}());

(0, _ava2.default)('should use grouping functions by filename provided by user', function () {
	var _ref11 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_index2.default.mark(function _callee3(t) {
		var _rec6 = new _powerAssertRecorder();

		var images, opts, _ref12, _ref13, _ref14, _ref15;

		return _index2.default.wrap(function _callee3$(_context3) {
			while (1) {
				switch (_context3.prev = _context3.next) {
					case 0:
						images = void 0, opts = void 0;


						t.context.opts.retina = true;
						t.context.opts.groupBy.push(function (image) {
							if (image.styleFilePath.indexOf('test.css') !== -1) {
								return _bluebird2.default.resolve('testing');
							}

							return _bluebird2.default.reject();
						});

						(0, _core.prepareGroupBy)(t.context.opts);

						_context3.next = 6;
						return (0, _core.extractImages)(t.context.ast, t.context.opts);

					case 6:
						_ref12 = _context3.sent;
						_ref13 = (0, _slicedToArray3.default)(_ref12, 2);
						opts = _ref13[0];
						images = _ref13[1];
						_context3.next = 12;
						return (0, _core.applyGroupBy)(t.context.opts, images);

					case 12:
						_ref14 = _context3.sent;
						_ref15 = (0, _slicedToArray3.default)(_ref14, 2);
						opts = _ref15[0];
						images = _ref15[1];


						t.truthy(_rec6._expr(_rec6._capt(_rec6._capt(_rec6._capt(_rec6._capt(_rec6._capt(images, 'arguments/0/left/callee/object/object/object')[0], 'arguments/0/left/callee/object/object').groups, 'arguments/0/left/callee/object').indexOf('testing'), 'arguments/0/left') > _rec6._capt(-1, 'arguments/0/right'), 'arguments/0'), {
							content: 't.truthy(images[0].groups.indexOf(\'testing\') > -1)',
							filepath: 'test/05-apply-group-by.js',
							line: 69,
							async: true
						}));

					case 17:
					case 'end':
						return _context3.stop();
				}
			}
		}, _callee3, undefined);
	}));

	return function (_x3) {
		return _ref11.apply(this, arguments);
	};
}());
//# sourceMappingURL=../node_modules/.cache/ava/fa683ec0d3466ef65ca9d5782ad61f38.js.map